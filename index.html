<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Esther's Box</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23f2ece9%22/><text y=%22.9em%22 font-size=%2280%22 font-family=%22serif%22 fill=%22%23b58d88%22>EB</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23f2ece9%22/><text y=%22.9em%22 font-size=%2280%22 font-family=%22serif%22 fill=%22%23b58d88%22>EB</text></svg>">

    <style>
        /* ä½é¥±å’Œåº¦è‰²å½©ä½“ç³» - é»˜è®¤ï¼šæš®è‰²ç«ç‘° */
        :root { 
            --bg-color: #f2ece9; 
            --glass-bg: rgba(255, 255, 255, 0.4); 
            --text-color: #5a5a5a; 
            --accent-color: #b58d88; 
        }

        * { 
            -webkit-tap-highlight-color: transparent; 
            box-sizing: border-box; 
        }

        body { 
            background: var(--bg-color); 
            color: var(--text-color); 
            font-family: 'PingFang SC', 'STSong', serif; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
            transition: all 0.5s ease; 
            padding-bottom: 50px; 
            overflow-x: hidden; 
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ */
        .header-container { 
            margin-top: 40px; 
            width: 92%; 
            max-width: 600px; 
            text-align: center; 
        }

        .main-title { 
            font-size: 26px; 
            letter-spacing: 5px; 
            color: var(--text-color); 
            margin-bottom: 25px; 
            text-transform: uppercase; 
            font-weight: normal; 
            font-family: 'STSong', serif; 
        }

        /* æœç´¢æ¡† */
        .search-bar { 
            width: 100%; 
            margin-bottom: 20px; 
        }

        .search-bar input { 
            width: 100%; 
            padding: 14px 20px; 
            border-radius: 25px; 
            border: 1px solid rgba(0,0,0,0.05); 
            background: var(--glass-bg); 
            backdrop-filter: blur(10px); 
            color: var(--text-color); 
            outline: none; 
            font-size: 14px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.02); 
        }

        /* å·¥å…·æ é€‚é…ä¼˜åŒ– */
        .toolbar { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            justify-content: center; 
            margin-bottom: 30px; 
        }

        .tool-btn { 
            background: var(--glass-bg); 
            border: 1px solid rgba(0,0,0,0.08); 
            padding: 8px 12px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 11px; 
            color: var(--text-color); 
            backdrop-filter: blur(5px); 
            white-space: nowrap; 
            flex-grow: 1; 
            max-width: calc(33% - 8px); 
            text-align: center; 
        }
        
        @media (max-width: 480px) {
            .tool-btn { max-width: calc(50% - 8px); }
            .tool-btn.func-btn { background: var(--accent-color); color: white; border: none; }
        }

        /* è¾“å…¥åŒºåŸŸå¡ç‰‡ */
        .input-card { 
            width: 92%; 
            max-width: 600px; 
            background: var(--glass-bg); 
            backdrop-filter: blur(10px); 
            padding: 22px; 
            border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.5); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.03); 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }

        .title-input { 
            width: 100%; 
            background: transparent; 
            border: none; 
            border-bottom: 1px solid rgba(0,0,0,0.05); 
            outline: none; 
            font-size: 18px; 
            font-family: 'STSong', serif; 
            color: var(--text-color); 
            padding: 5px 0; 
            font-weight: bold; 
        }

        textarea { 
            width: 100%; 
            height: 110px; 
            background: transparent; 
            border: none; 
            outline: none; 
            font-size: 16px; 
            color: var(--text-color); 
            resize: none; 
            font-family: inherit; 
            line-height: 1.6; 
        }
        
        /* æ ‡ç­¾é€‰æ‹© */
        .tag-picker { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap; 
        }

        .label-tag { 
            font-size: 11px; 
            padding: 6px 14px; 
            border-radius: 15px; 
            background: rgba(0,0,0,0.03); 
            cursor: pointer; 
            border: 1px solid transparent; 
            transition: 0.3s; 
            color: #777; 
        }

        .label-tag.active { 
            background: var(--accent-color); 
            color: white; 
        }

        /* æ“ä½œæŒ‰é’®ç»„ */
        .btn-group { 
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; 
        }

        .post-btn { 
            background: var(--accent-color); 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            border-radius: 20px; 
            font-size: 13px; 
            letter-spacing: 1px; 
            cursor: pointer; 
        }

        .cancel-btn { 
            background: rgba(0,0,0,0.05); 
            color: #777; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 20px; 
            font-size: 13px; 
            cursor: pointer; 
            display: none; 
        }

        /* ç”»å»Šå±•ç¤ºåŒºåŸŸ */
        .gallery { 
            display: flex; 
            flex-direction: column; 
            gap: 18px; 
            width: 92%; 
            max-width: 600px; 
            margin-top: 35px; 
        }

        .card { 
            background: var(--glass-bg); 
            backdrop-filter: blur(8px); 
            border-radius: 18px; 
            padding: 22px; 
            border: 1px solid rgba(255,255,255,0.3); 
            position: relative; 
        }

        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 15px; 
        }

        .card-meta { 
            display: flex; 
            flex-direction: column; 
            gap: 4px; 
        }

        .card-date { 
            font-size: 11px; 
            color: var(--accent-color); 
            letter-spacing: 0.5px; 
            opacity: 0.8; 
        }

        .card-tag { 
            font-size: 9px; 
            padding: 2px 8px; 
            background: rgba(0,0,0,0.05); 
            border-radius: 8px; 
            color: #999; 
            align-self: flex-start; 
        }

        .action-btns { 
            display: flex; 
            gap: 12px; 
            color: var(--accent-color); 
            opacity: 0.6; 
        }

        .action-icon { 
            cursor: pointer; 
            font-size: 13px; 
            padding: 4px; 
        }

        /* åŠ ç²—åçš„å¡ç‰‡æ ‡é¢˜ */
        .card-title { 
            font-size: 18px; 
            font-weight: bold; 
            font-family: 'STSong', serif; 
            margin-bottom: 12px; 
            color: #333; 
            letter-spacing: 1px; 
        }

        .card-content { 
            font-size: 15px; 
            line-height: 1.7; 
            white-space: pre-wrap; 
            color: #555; 
        }
    </style>
</head>
<body>

    <div class="header-container">
        <h1 class="main-title">Esther's Box</h1>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="æœç´¢è®°å¿†ç¢ç‰‡..." oninput="filterNotes()">
        </div>
        <div class="toolbar">
            <button class="tool-btn" onclick="setTheme('rose')">æš®è‰²ç«ç‘°</button>
            <button class="tool-btn" onclick="setTheme('default')">ç»å…¸é©¼</button>
            <button class="tool-btn" onclick="setTheme('lagoon')">æ³»æ¹–è“</button>
            <button class="tool-btn func-btn" onclick="exportNotes()">ğŸ’¾ å­˜æ¡£</button>
            <button class="tool-btn func-btn" onclick="document.getElementById('fileInput').click()">ğŸ“¥ æå–</button>
            <input type="file" id="fileInput" style="display:none" onchange="importNotes(event)">
        </div>
    </div>

    <div class="input-card">
        <input type="text" id="titleInput" class="title-input" placeholder="èµ·ä¸ªå°æ ‡é¢˜å§...">
        <textarea id="noteInput" placeholder="æ•æ‰æ­¤åˆ»æµåŠ¨çš„çµæ„Ÿ..."></textarea>
        <div class="tag-picker" id="tagPicker">
            <div class="label-tag active" onclick="selectTag(this)">ç¢ç¢å¿µ</div>
            <div class="label-tag" onclick="selectTag(this)">è¥é€ äººé—´</div>
            <div class="label-tag" onclick="selectTag(this)">æ—‹å¾‹å·¥åŠ</div>
            <div class="label-tag" onclick="selectTag(this)">å®¡ç¾æ¡£æ¡ˆ</div>
        </div>
        <div class="btn-group">
            <button id="cancelBtn" class="cancel-btn" onclick="cancelEdit()">å–æ¶ˆ</button>
            <button id="postBtn" class="post-btn" onclick="saveNote()">POST</button>
        </div>
    </div>

    <div id="gallery" class="gallery"></div>

    <script>
        // åˆå§‹åŒ–æ•°æ®
        let notes = JSON.parse(localStorage.getItem('esthers_box_notes')) || [];
        let currentTag = "ç¢ç¢å¿µ";
        let editId = null;

        // é¦–æ¬¡åŠ è½½æ¸²æŸ“
        renderNotes(notes);

        // æ ‡ç­¾åˆ‡æ¢é€»è¾‘
        function selectTag(el) {
            document.querySelectorAll('.label-tag').forEach(tag => {
                tag.classList.remove('active');
            });
            el.classList.add('active');
            currentTag = el.innerText;
        }

        // ä¿å­˜/æ›´æ–°ç¬”è®°é€»è¾‘
        function saveNote() {
            const titleInput = document.getElementById('titleInput');
            const noteInput = document.getElementById('noteInput');
            
            if (!noteInput.value.trim()) return;

            const titleValue = titleInput.value.trim() || "æ— é¢˜";

            if (editId) {
                // ç¼–è¾‘æ¨¡å¼ï¼šå¯»æ‰¾æ—§æ•°æ®å¹¶æ›¿æ¢
                const index = notes.findIndex(n => n.id === editId);
                if (index !== -1) {
                    notes[index].title = titleValue;
                    notes[index].content = noteInput.value;
                    notes[index].tag = currentTag;
                }
                editId = null;
                document.getElementById('postBtn').innerText = 'POST';
                document.getElementById('cancelBtn').style.display = 'none';
            } else {
                // æ–°å¢æ¨¡å¼ï¼šæ¨å…¥æ•°ç»„é¦–ä½
                const newNote = { 
                    id: Date.now(), 
                    title: titleValue, 
                    content: noteInput.value, 
                    tag: currentTag, 
                    date: new Date().toLocaleString('zh-CN', { hour12: false }) 
                };
                notes.unshift(newNote);
            }

            // åŒæ­¥åˆ°æœ¬åœ°å­˜å‚¨å¹¶åˆ·æ–°ç•Œé¢
            localStorage.setItem('esthers_box_notes', JSON.stringify(notes));
            titleInput.value = '';
            noteInput.value = '';
            renderNotes(notes);
        }

        // è¿›å…¥ç¼–è¾‘æ¨¡å¼
        function editNote(id) {
            const note = notes.find(n => n.id === id);
            if (!note) return;

            editId = id;
            document.getElementById('titleInput').value = note.title === "æ— é¢˜" ? "" : note.title;
            document.getElementById('noteInput').value = note.content;
            document.getElementById('noteInput').focus();

            // åŒæ­¥æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            const tags = document.querySelectorAll('.label-tag');
            tags.forEach(t => {
                if (t.innerText === note.tag) selectTag(t);
            });

            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            document.getElementById('postBtn').innerText = 'UPDATE';
            document.getElementById('cancelBtn').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            editId = null;
            document.getElementById('titleInput').value = '';
            document.getElementById('noteInput').value = '';
            document.getElementById('postBtn').innerText = 'POST';
            document.getElementById('cancelBtn').style.display = 'none';
        }

        // å¼ºåŠ›å¤åˆ¶åŠŸèƒ½ (åŒ…å« Fallback æ–¹æ¡ˆ)
        function copyNote(id) {
            const note = notes.find(n => n.id === id);
            if (!note) return;
            const fullText = (note.title !== "æ— é¢˜" ? `ã€${note.title}ã€‘\n` : "") + note.content;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(fullText).then(() => {
                    alert('çµæ„Ÿå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ âœ¨');
                }).catch(() => {
                    fallbackCopy(fullText);
                });
            } else {
                fallbackCopy(fullText);
            }
        }

        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopy(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('çµæ„Ÿå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ âœ¨');
            } catch (err) {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡å­—');
            }
            document.body.removeChild(textArea);
        }

        // æœç´¢è¿‡æ»¤
        function filterNotes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = notes.filter(note => 
                note.content.toLowerCase().includes(searchTerm) || 
                note.tag.toLowerCase().includes(searchTerm) || 
                (note.title && note.title.toLowerCase().includes(searchTerm))
            );
            renderNotes(filtered);
        }

        // æ ¸å¿ƒæ¸²æŸ“å‡½æ•°
        function renderNotes(data) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = data.map(note => `
                <div class="card">
                    <div class="card-header">
                        <div class="card-meta">
                            <div class="card-date">${note.date}</div>
                            <div class="card-tag">${note.tag}</div>
                        </div>
                        <div class="action-btns">
                            <span class="action-icon" title="å¤åˆ¶" onclick="copyNote(${note.id})">ğŸ“‹</span>
                            <span class="action-icon" title="ç¼–è¾‘" onclick="editNote(${note.id})">âœ</span>
                            <span class="action-icon" title="åˆ é™¤" onclick="deleteNote(${note.id})">âœ•</span>
                        </div>
                    </div>
                    ${note.title && note.title !== "æ— é¢˜" ? `<div class="card-title">${note.title}</div>` : ""}
                    <div class="card-content">${note.content}</div>
                </div>
            `).join('');
        }

        // åˆ é™¤ç¬”è®°
        function deleteNote(id) {
            if(confirm('è¦åˆ é™¤è¿™æ®µçè´µçš„çµæ„Ÿå—ï¼Ÿ')) {
                notes = notes.filter(note => note.id !== id);
                localStorage.setItem('esthers_box_notes', JSON.stringify(notes));
                renderNotes(notes);
            }
        }

        // ä¸»é¢˜åˆ‡æ¢é€»è¾‘
        function setTheme(theme) {
            const root = document.documentElement;
            const themes = {
                rose: { bg: '#f2ece9', accent: '#b58d88' },
                default: { bg: '#f4f1ea', accent: '#a89a8e' },
                lagoon: { bg: '#e8f0f2', accent: '#7a96a2' }
            };
            root.style.setProperty('--bg-color', themes[theme].bg);
            root.style.setProperty('--accent-color', themes[theme].accent);
        }

        // å¯¼å‡ºå¤‡ä»½
        function exportNotes() {
            if (notes.length === 0) return;
            const blob = new Blob([JSON.stringify(notes, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Esthers_Box_Archive.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥æå–
        function importNotes(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    // åˆå¹¶å¹¶å»é‡
                    notes = [...imported, ...notes];
                    const uniqueIds = new Set();
                    notes = notes.filter(n => uniqueIds.has(n.id) ? false : uniqueIds.add(n.id));
                    localStorage.setItem('esthers_box_notes', JSON.stringify(notes));
                    renderNotes(notes);
                    alert('çµæ„Ÿå·²æˆåŠŸæå–');
                } catch (err) {
                    alert('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>